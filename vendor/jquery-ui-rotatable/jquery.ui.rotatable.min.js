(function(e,t){e.widget("ui.rotatable",e.ui.mouse,{options:{handle:false,angle:false,start:null,rotate:null,stop:null},handle:function(e){if(e===t){return this.options.handle}this.options.handle=e},angle:function(e){if(e===t){return this.options.angle}this.options.angle=e;this.elementCurrentAngle=e;this.performRotation(this.options.angle)},_create:function(){var t;if(!this.options.handle){t=e(document.createElement("div"));t.addClass("ui-rotatable-handle")}else{t=this.options.handle}this.listeners={rotateElement:e.proxy(this.rotateElement,this),startRotate:e.proxy(this.startRotate,this),stopRotate:e.proxy(this.stopRotate,this)};t.draggable({helper:"clone",start:this.dragStart,handle:t});t.bind("mousedown",this.listeners.startRotate);t.appendTo(this.element);if(this.options.angle!=false){this.elementCurrentAngle=this.options.angle;this.performRotation(this.elementCurrentAngle)}else{this.elementCurrentAngle=0}},_destroy:function(){this.element.removeClass("ui-rotatable");this.element.find(".ui-rotatable-handle").remove()},performRotation:function(e){this.element.css("transform","rotate("+e+"rad)");this.element.css("-moz-transform","rotate("+e+"rad)");this.element.css("-webkit-transform","rotate("+e+"rad)");this.element.css("-o-transform","rotate("+e+"rad)")},getElementOffset:function(){this.performRotation(0);var e=this.element.offset();this.performRotation(this.elementCurrentAngle);return e},getElementCenter:function(){var e=this.getElementOffset();var t=e.left+this.element.width()/2;var n=e.top+this.element.height()/2;return Array(t,n)},dragStart:function(e){if(this.element){return false}},startRotate:function(t){var n=this.getElementCenter();var r=t.pageX-n[0];var i=t.pageY-n[1];this.mouseStartAngle=Math.atan2(i,r);this.elementStartAngle=this.elementCurrentAngle;this.hasRotated=false;this._propagate("start",t);e(document).bind("mousemove",this.listeners.rotateElement);e(document).bind("mouseup",this.listeners.stopRotate);return false},rotateElement:function(e){if(!this.element||this.element.disabled){return false}var t=this.getElementCenter();var n=e.pageX-t[0];var r=e.pageY-t[1];var i=Math.atan2(r,n);var s=i-this.mouseStartAngle+this.elementStartAngle;if(e.shiftKey){var o=15/180*Math.PI;if(s<0)o*=-1;s-=(s+o/2)%o-o/2}this.performRotation(s);var u=this.elementCurrentAngle;this.elementCurrentAngle=s;this._propagate("rotate",e);if(u!=s){this._trigger("rotate",e,this.ui());this.hasRotated=true}return false},stopRotate:function(t){if(!this.element||this.element.disabled){return}e(document).unbind("mousemove",this.listeners.rotateElement);e(document).unbind("mouseup",this.listeners.stopRotate);this.elementStopAngle=this.elementCurrentAngle;if(this.hasRotated){this._propagate("stop",t)}setTimeout(function(){this.element=false},10);return false},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]);t!=="rotate"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{element:this.element,angle:{start:this.elementStartAngle,current:this.elementCurrentAngle,stop:this.elementStopAngle}}}})})(jQuery)
